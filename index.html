<!DOCTYPE html>
<html>

<head>
	<title>Indian poker</title>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="style.css">

	<script type="text/javascript">
		function load(n) {
			for (i = 1; i < n; i++) {
				var card = cards.splice(Math.floor(Math.random() * cards.length), 1)
				opponent_cards.push(card)
				document.getElementById("opponents1").innerHTML += "<div class=\"card\" id=\"card1" + i + "\">" + mark[Math.floor((card - 1) / 10)] + ((card - 1) % 10 + 1) + "</div>"
				document.getElementById("opponents2").innerHTML += "<div class=\"card\" id=\"card2" + i + "\"></div>"
			}

			var card = cards.splice(Math.floor(Math.random() * cards.length), 1)
			player_card = card
			document.getElementById("player2").innerHTML += "<div class=\"card\" id=\"card\">" + mark[Math.floor((card - 1) / 10)] + ((card - 1) % 10 + 1) + "</div>"
			document.getElementById("player1").innerHTML += "<div class=\"card\" id=\"card2\"></div>"
			calculate(card, cards)
		}
		function points(card1, card2) {
			var number1 = (card1 - 1) % 10 + 1
			var symbol1 = Math.floor((card1 - 1) / 10)
			var number2 = (card2 - 1) % 10 + 1
			var symbol2 = Math.floor((card2 - 1) / 10)

			if (number1 == number2) {
				return 20 + number1
			}
			if (symbol1 == symbol2) {
				return 10 + Math.max(number1, number2)
			}
			return Math.max(number1, number2)
		}
		function calculate(card, cards) {
			//left = 0
			//right = 0
			for (i = 0; i < cards.length; i++) {
				points1 = points(card, cards[i])
				for (j = 0; j < cards.length; j++) {
					if (j != i) {
						if (points(opponent_cards[0], cards[j]) == points1) {
							draw++
						}
						if (points(opponent_cards[0], cards[j]) >= points1) {
							won -= (cards.length - 2)
							//left += (cards.length - 2)
						}
						else {
							for (k = 0; k < cards.length; k++) {
								if (k != j && k != i) {
									if (points(opponent_cards[1], cards[k]) == points1) {
										draw++
									}
									if (points(opponent_cards[1], cards[k]) >= points1) {
										won--
										//right++
									}
								}
							}
						}
					}
				}
			}
			document.getElementById("won").innerHTML = "Win chance: " + (won / apsolute * 100).toFixed(2) + "%"
			document.getElementById("draw").innerHTML = "Draw chance: " + (draw / apsolute * 100).toFixed(2) + "%"
			//document.getElementById("left").innerHTML = "Left: " + (left / apsolute * 100).toFixed(2) + "%"
			//document.getElementById("right").innerHTML = "Right: " + (right / apsolute * 100).toFixed(2) + "%"
		}
		function check() {
			document.getElementById("show").innerHTML = ""

			var card = cards.splice(Math.floor(Math.random() * cards.length), 1)
			document.getElementById("card2").innerHTML = mark[Math.floor((card - 1) / 10)] + ((card - 1) % 10 + 1)
			p1 = points(card, player_card)

			var card = cards.splice(Math.floor(Math.random() * cards.length), 1)
			document.getElementById("card21").innerHTML = mark[Math.floor((card - 1) / 10)] + ((card - 1) % 10 + 1)
			p2 = points(card, opponent_cards[0])

			var card = cards.splice(Math.floor(Math.random() * cards.length), 1)
			document.getElementById("card22").innerHTML = mark[Math.floor((card - 1) / 10)] + ((card - 1) % 10 + 1)
			p3 = points(card, opponent_cards[1])

			document.getElementById("won").innerHTML = ""
			document.getElementById("draw").innerHTML = ""

			if (Math.max(p1, p2, p3) == p1) {
				if (p1 == Math.max(p2, p3)) {
					document.getElementById("won").innerHTML = "It's a draw!"
					return
				}
				document.getElementById("won").innerHTML = "You won!"
				return
			}
			document.getElementById("won").innerHTML = "You lost!"
		}
	</script>
</head>

<body>
	<div class="player" id="opponents1"></div>
	<br>
	<div class="player" id="opponents2"></div>
	<br>
	<br>
	<br>
	<div class="player" id="player1"></div>
	<br>
	<div class="player" id="player2"></div>

	<br>

	<p class="chance" id="won"></p>
	<p class="chance" id="draw"></p>
	<p id="show">
		<input class="button" type="button" onclick="check()" value="Showdown" />
	</p>
	<!--<p class="chance" id="left"></p>
	<p class="chance" id="right"></p>-->
	<script type="text/javascript">
		let cards = []
		let opponent_cards = []
		let player_card = 0
		let mark = ["♠", "♣", "♥", "♦"]
		for (i = 1; i <= 40; i++) {
			cards.push(i)
		}
		//let n = Number(prompt("Broj igraca:"))
		//if (Number.isInteger(n) && n <= 20 && n > 0) {
		//load(n)
		//}
		let n = 3
		let chance = 0
		let apsolute = 40 - n
		for (i = 1; i < n; i++) {
			apsolute *= (40 - n - i)
		}
		let won = apsolute
		let draw = 0
		load(n)
	</script>
</body>

</html>
